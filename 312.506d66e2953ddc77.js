"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[312],{5312:(H,g,s)=>{s.r(g),s.d(g,{CamModule:()=>B});var c=s(6814),d=s(95),p=s(7403),e=s(5849),b=s(3246),m=s(5219),x=s(1850),v=s(6623),u=s(707),T=s(6651),f=s(4480),C=s(4104),h=s(5389),Z=s(6128);const y=["videoElement"],A=["canvasElement"],I=()=>({height:"4px"});function U(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"section",28),e._UZ(1,"i",29),e.TgZ(2,"div",30)(3,"p",31),e._uU(4),e.qZA(),e.TgZ(5,"p",32),e._uU(6),e.qZA(),e.TgZ(7,"div",33),e._UZ(8,"p-progressBar",34),e.TgZ(9,"label",35),e._uU(10),e.qZA()(),e.TgZ(11,"div",36)(12,"p-button",37),e.NdJ("onClick",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onClose())}),e.qZA(),e.TgZ(13,"p-button",38),e.NdJ("onClick",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onClose())}),e.qZA()()()()}if(2&n){const t=r.$implicit,i=e.oxw();e.xp6(4),e.hij(" ",t.summary," "),e.xp6(2),e.hij(" ",t.detail," "),e.xp6(2),e.Akn(e.DdM(9,I)),e.Q6J("value",i.progress)("showValue",!1),e.xp6(2),e.hij(" ",i.progress,"% uploaded... "),e.xp6(2),e.Q6J("text",!0),e.xp6(1),e.Q6J("text",!0)}}function E(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.predictImage())}),e._UZ(1,"i",40),e.TgZ(2,"span"),e._uU(3,"Predecir"),e.qZA()()}}function w(n,r){if(1&n&&(e.TgZ(0,"div",41)(1,"h3"),e._uU(2,"Imagen Capturada:"),e.qZA(),e._UZ(3,"img",42),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.Q6J("src",t.capturedImage,e.LSH)}}function S(n,r){1&n&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"#"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Predicci\xf3n"),e.qZA()())}function J(n,r){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&n){const t=r.$implicit,i=r.rowIndex;e.xp6(2),e.Oqu(i+1),e.xp6(2),e.Oqu(t)}}const M=()=>({"min-width":"50rem"});let _=(()=>{class n{constructor(t,i,a,o,l){this.predictionService=t,this.message=i,this.cdr=a,this.route=o,this.auth=l,this.capturedImage=null,this.facingMode="user",this.stream=null,this.predictions=[],this.audio_Url="",this.capturedPhoto=!1,this.predict=!1,this.visible=!1,this.playAud=!1,this.progress=0,this.interval=null,this.selectedSize="",this.useRearCamera=!0}ngAfterViewInit(){navigator.mediaDevices.getUserMedia({video:{facingMode:this.useRearCamera?"environment":"user",width:{ideal:1280},height:{ideal:720}}}).then(t=>{this.videoElement.nativeElement.srcObject=t}).catch(t=>{console.error("Error al acceder a la c\xe1mara:",t)}),this.verifyAuthState()}startCamera(){navigator.mediaDevices.getUserMedia({video:{facingMode:this.useRearCamera?"environment":"user"}}).then(i=>{this.videoElement.nativeElement.srcObject=i}).catch(i=>{console.error("Error al acceder a la c\xe1mara:",i)})}toggleCamera(){this.useRearCamera=!this.useRearCamera,this.stopCurrentStream(),setTimeout(()=>{this.initCamera()},500)}stopCurrentStream(){this.stream&&(this.stream.getTracks().forEach(t=>{t.stop()}),this.stream=null)}initCamera(){navigator.mediaDevices.enumerateDevices().then(t=>{const i=t.filter(o=>"videoinput"===o.kind),a=this.useRearCamera?i.find(o=>o.label.toLowerCase().includes("back"))?.deviceId:i.find(o=>o.label.toLowerCase().includes("front"))?.deviceId;a?navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:a}}}).then(o=>{this.stream=o,this.videoElement.nativeElement.srcObject=o,this.videoElement.nativeElement.onloadedmetadata=()=>{console.log("La c\xe1mara est\xe1 lista"),this.videoElement.nativeElement.play()}}).catch(o=>{console.error("Error al acceder a la c\xe1mara:",o)}):console.error("No se encontr\xf3 la c\xe1mara deseada.")})}ngOnInit(){console.log("xd"),this.sizes=[{name:"Small",class:"p-datatable-sm"},{name:"Normal",class:""},{name:"Large",class:"p-datatable-lg"}],this.selectedSize=this.sizes[2],this.route.queryParams.subscribe(t=>{t.capture&&(this.capturedPhoto=!0,this.capturePhoto()),t.predict&&(this.predict=!0,this.predictImage(),setTimeout(()=>{this.playAudio(this.audio_Url)},2e3))})}onSizeChange(){console.log(this.selectedSize),this.cdr.detectChanges()}capturePhoto(){this.showConfirm();const t=this.canvasElement.nativeElement,i=this.videoElement.nativeElement;t.width=256,t.height=256;const l=t.getContext("2d");l&&(l.drawImage(i,0,0,256,256),this.capturedImage=t.toDataURL("image/png"))}predictImage(){this.capturedImage&&this.predictionService.predictImage(this.capturedImage).subscribe(t=>{this.predictions=t.predictions,this.audio_Url=t.audio_url,console.log("lol",this.audio_Url),console.log("Predicciones:",this.predictions),this.showSuccess(),this.showInfo(),this.onClose()},t=>{console.error("Error al predecir:",t),this.showError()})}showSuccess(){this.message.add({severity:"success",summary:"Success",detail:"Predicciones realizadas con exito !"})}showInfo(){this.message.add({severity:"info",summary:"Info",detail:"Revisar las predicciones en la secci\xf3n 3"})}showError(){this.message.add({severity:"error",summary:"Error",detail:"Error al predecir"})}onClose(){this.visible=!1,this.message.clear("confirm")}playAudio(t){new Audio(t).play(),console.log("xd",t)}showConfirm(){this.visible||(this.message.add({key:"confirm",sticky:!0,severity:"custom",summary:"Subiendo tu imagen."}),this.visible=!0,this.progress=0,this.interval&&clearInterval(this.interval),this.interval=setInterval(()=>{this.progress<=100&&(this.progress=this.progress+20),this.progress>=100&&(this.progress=100,clearInterval(this.interval)),this.cdr.markForCheck()},1e3))}verifyAuthState(){this.auth.checkLoggedIn()||this.message.add({severity:"info",summary:"Advertencia",detail:"Estimado usuario, para poder realizar predicciones debe iniciar sesion."})}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(b.w),e.Y36(m.ez),e.Y36(e.sBO),e.Y36(p.gz),e.Y36(x.e))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-cam"]],viewQuery:function(i,a){if(1&i&&(e.Gf(y,5),e.Gf(A,5)),2&i){let o;e.iGM(o=e.CRH())&&(a.videoElement=o.first),e.iGM(o=e.CRH())&&(a.canvasElement=o.first)}},decls:37,vars:15,consts:[["position","top-center","key","confirm",3,"baseZIndex","onClose"],["pTemplate","headless"],[1,"card","flex","justify-content-center"],[1,"w-full","md:w-8","lg:w-6"],[3,"activeIndex"],["header","1. Tomar Foto"],[1,"p-mb-4"],[1,"camera-view-container","flex","align-items-center","justify-content-center","p-shadow-4","p-p-3","p-mb-4"],["autoplay","",1,"p-fluid","rounded-video","w-full","sm:w-10","md:w-8","lg:w-6","h-auto"],["videoElement",""],[1,"photo-preview","p-shadow-4","rounded-canvas","p-d-none"],["canvasElement",""],[1,"button-group","p-d-flex","p-jc-center","p-gap-3"],[1,"p-button","p-button-rounded","p-button-outlined","p-button-secondary",3,"click"],[1,"pi","pi-refresh"],[1,"p-button","p-button-rounded","p-button-outlined","p-button-success",3,"click"],[1,"pi","pi-camera"],["class","p-button p-button-rounded p-button-info",3,"click",4,"ngIf"],["header","2. Imagen Capturada"],["class","p-mt-4 captured-image-container p-shadow-4",4,"ngIf"],["header","3. Predicciones"],[1,"card"],[1,"flex","justify-content-center","mb-3"],["optionLabel","name","optionValue","class",3,"options","ngModel","multiple","ngModelChange"],[3,"ngClass","tableStyle","styleClass","value","paginator","rows"],["pTemplate","header"],["pTemplate","body"],["pButton","","pRipple","","icon","pi pi-volume-up",1,"p-button-text",3,"click"],[1,"flex","p-3","gap-3","w-full","bg-black-alpha-90","shadow-2",2,"border-radius","10px"],[1,"pi","pi-cloud-upload","text-primary-500","text-2xl"],[1,"flex","flex-column","gap-3","w-full"],[1,"m-0","font-semibold","text-base","text-white"],[1,"m-0","text-base","text-700"],[1,"flex","flex-column","gap-2"],[3,"value","showValue"],[1,"text-right","text-xs","text-white"],[1,"flex","gap-3","mb-3"],["label","Subir otra imagen?","styleClass","p-0",3,"text","onClick"],["label","Cancelar","styleClass","text-white p-0",3,"text","onClick"],[1,"p-button","p-button-rounded","p-button-info",3,"click"],[1,"pi","pi-cloud-upload"],[1,"p-mt-4","captured-image-container","p-shadow-4"],["alt","Imagen capturada",1,"rounded-image",3,"src"]],template:function(i,a){1&i&&(e.TgZ(0,"p-toast",0),e.NdJ("onClose",function(){return a.onClose()}),e.YNc(1,U,14,10,"ng-template",1),e.qZA(),e.TgZ(2,"div",2)(3,"div",3)(4,"p-accordion",4)(5,"p-accordionTab",5)(6,"h2",6),e._uU(7,"Usa la C\xe1mara"),e.qZA(),e.TgZ(8,"div",7),e._UZ(9,"video",8,9),e.qZA(),e._UZ(11,"canvas",10,11),e.TgZ(13,"div",12)(14,"button",13),e.NdJ("click",function(){return a.toggleCamera()}),e._UZ(15,"i",14),e.TgZ(16,"span"),e._uU(17,"Cambiar C\xe1mara"),e.qZA()(),e.TgZ(18,"button",15),e.NdJ("click",function(){return a.capturePhoto()}),e._UZ(19,"i",16),e.TgZ(20,"span"),e._uU(21,"Tomar Foto"),e.qZA()(),e.YNc(22,E,4,0,"button",17),e.qZA()(),e.TgZ(23,"p-accordionTab",18),e.YNc(24,w,4,1,"div",19),e.qZA(),e.TgZ(25,"p-accordionTab",20)(26,"p"),e._uU(27),e.qZA(),e.TgZ(28,"div",21)(29,"div",22)(30,"p-selectButton",23),e.NdJ("ngModelChange",function(l){return a.selectedSize=l}),e.qZA()(),e.TgZ(31,"p-table",24),e.YNc(32,S,5,0,"ng-template",25)(33,J,5,2,"ng-template",26),e.qZA(),e.TgZ(34,"button",27),e.NdJ("click",function(){return a.playAudio(a.audio_Url)}),e._uU(35," Reproducir "),e.qZA()()()()()(),e._UZ(36,"p-toast")),2&i&&(e.Q6J("baseZIndex",5e3),e.xp6(4),e.Q6J("activeIndex",0),e.xp6(18),e.Q6J("ngIf",a.capturedImage),e.xp6(2),e.Q6J("ngIf",a.capturedImage),e.xp6(3),e.Oqu(a.selectedSize.class),e.xp6(3),e.Q6J("options",a.sizes)("ngModel",a.selectedSize)("multiple",!1),e.xp6(1),e.Q6J("ngClass",a.selectedSize.class)("tableStyle",e.DdM(14,M))("styleClass",a.selectedSize.class)("value",a.predictions)("paginator",!0)("rows",5))},dependencies:[c.mk,c.O5,v.iA,m.jx,u.Hq,u.zx,T.k,d.JJ,d.On,f.H,C.FN,h.UQ,h.US,Z.UN]})}return n})(),z=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#i=this.\u0275inj=e.cJS({imports:[p.Bz.forChild([{path:"",component:_}]),p.Bz]})}return n})();var N=s(8857),k=s(6340),j=s(6022),Q=s(3714),R=s(6218),O=s(2352),P=s(1865),D=s(354),F=s(7213);let B=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#i=this.\u0275inj=e.cJS({providers:[m.ez],imports:[c.ez,z,v.U$,N.O,d.u5,u.hJ,f.T,C.EV,k.V,j.Xt,Q.j,R.A,O.kW,P.cc,D.L$,F.S,h.fx,Z.Qy]})}return n})()}}]);